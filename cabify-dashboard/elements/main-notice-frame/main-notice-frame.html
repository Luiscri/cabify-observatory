<link rel="import" href="/bower_components/polymer/polymer.html">

<dom-module id="main-notice-frame">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="import" type="css" href="main-notice-frame.css">

    <template>
        <div style$="height: {{height}}px;">
            <div class="row h-100">
                <div class="col-12 col-md-5 h-100 p-0">
                    <div
                        class="article-image h-100 w-100"
                        style$="background-image: url('{{getArticleImage(article)}}'); background-color: #{{bgcolor}};"
                    >
                    </div>
                </div>
                <div class="col-12 col-md-7 h-100" style$="background-color: #{{bgcolor}};">
                    <div class="h-100 content-box">
                        <h1 class="article-headline">{{article.schema:headline}}</h1>
                        <div class="article-body">{{getArticleBody(article)}}</div>
                        <div id="button-box">
                            <button class="see-more-button" style="vertical-align:middle">
                                <span>Leer más</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        var filtered = false;

        Polymer({
            is: 'main-notice-frame',
            properties: {
                data: {
                    type: Object,
                    observer: '_dataChanged'              
                },

                height: {
                    type: String,
                    value: '500'
                },

                bgcolor: {
                    type: String,
                    value: 'e0e6e9'
                },

                article: {
                    type: Object
                },

                defaultimage: {
                    type: String
                },

                fields: {
                  type: Array,
                  value: function() { return []; }
                },

                filters: {
                  type: Array,
                  notify: true,
                  value: function() { return []; }
                }
            },

            _dataChanged: function() {
                var that = this
                var hits = that.data.hits.hits
                // Hacer para que coja la noticia que se haya publicado más tarde
                this.article = hits[1]._source
                console.log(this.article)
            },

            // Arreglar que cuando la url esté rota tambien saque la de defecto
            getArticleImage: function(article) {
                var defaultImage = this.defaultimage
                try{
                    var image = article['schema:thumbnailUrl']

                    // Check if thumbnail
                    if(image == "null"){
                        return defaultImage
                    }

                    // Check thumbnail size
                    var img = new Image();
                    img.src= image
                    img.onload = function(){
                        if(this.width < 250 || this.height < 250){
                            //alert (this.width + " " + this.height)
                            // Hay que hacer getElementById porque cuando la imagen hace el onload js ya ha asignado la url a la imagen
                            document.getElementById('article-image').style.backgroundImage = "url("+defaultImage+")"
                        }
                    };
                }
                catch(error){
                    var image = defaultImage
                }
                return image
            },

            getArticleBody: function(article){
                var fullBody = article['schema:articleBody']
                return fullBody.slice(0,1000)+"..."
            }
        });
    </script>
</dom-module>