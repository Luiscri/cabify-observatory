<link rel="import" href="/bower_components/polymer/polymer.html">
<script src="https://pvb.io/js/heatmap.js"></script>
<script src="https://pvb.io/js/leaflet-heatmap.js"></script>

<dom-module id="simple-heatmap">
    <template>
        <style>
            #heatmap {
                width: 100%;
                height: 400px;
            }
        </style>

        <div id="heatmap"> 
        </div>
    </template>

    <script>
        var filtered = false;

        Polymer({
            is: 'simple-heatmap',
            properties: {
                data: {
                    type: Object,
                    observer: '_dataChanged'              
                },

                maincolor: {
                    type: String,
                    value: '354169'
                },

                fields: {
                  type: Array,
                  value: function() { return []; }
                },

                filters: {
                  type: Array,
                  notify: true,
                  value: function() { return []; }
                }
            },

            _dataChanged: function() {
                let heatmapData = []
                this.data.forEach(function(point){
                    heatmapData.push({lat: point.lat, lng: point.lon, count: 1})
                });

                let dataCfg = {
                    data: heatmapData
                };

                let cfg = {
                    "radius": 15,
                    "maxOpacity": .5, 
                    "scaleRadius": false, 
                    "useLocalExtrema": true,
                    latField: 'lat',
                    lngField: 'lng',
                    valueField: 'count',
                    blur: 0.95,
                    gradient: { 
                        '.5': 'yellow',
                        '.8': 'orange',
                        '.95': 'red'
                    }
                };

                let map = new L.Map('heatmap').setView([40.416729, -3.703339], 5);
                L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                let heatmapLayer = new HeatmapOverlay(cfg).addTo(map);

                heatmapLayer.setData(dataCfg);

                document.getElementById('statistics').addEventListener('click', function(){
                    map.invalidateSize();
                });
            }
        });
    </script>
</dom-module>